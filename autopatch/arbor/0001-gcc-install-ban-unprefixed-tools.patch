From 5348c6bfefac74093593169be15ddabb3d3ef8dc Mon Sep 17 00:00:00 2001
From: Benedikt Morbach <moben@exherbo.org>
Date: Thu, 24 Mar 2016 14:47:31 +0100
Subject: [PATCH] gcc: install & ban unprefixed tools

Change-Id: Ib14a4d9fac8a4d16c4bea4ee3aa8bddfff18452d
Signed-off-by: Marc-Antoine Perennou <keruspe@exherbo.org>
---
 .../{gcc-4.9.2-r13.exheres-0 => gcc-4.9.2-r14.exheres-0} |  0
 .../{gcc-5.3.0-r5.exheres-0 => gcc-5.3.0-r6.exheres-0}   |  0
 .../{gcc-6.1.0-r1.exheres-0 => gcc-6.1.0-r2.exheres-0}   |  0
 packages/sys-devel/gcc/gcc.exlib                         | 16 ++++++++++++++++
 4 files changed, 16 insertions(+)
 rename packages/sys-devel/gcc/{gcc-4.9.2-r13.exheres-0 => gcc-4.9.2-r14.exheres-0} (100%)
 rename packages/sys-devel/gcc/{gcc-5.3.0-r5.exheres-0 => gcc-5.3.0-r6.exheres-0} (100%)
 rename packages/sys-devel/gcc/{gcc-6.1.0-r1.exheres-0 => gcc-6.1.0-r2.exheres-0} (100%)

diff --git a/packages/sys-devel/gcc/gcc-4.9.2-r13.exheres-0 b/packages/sys-devel/gcc/gcc-4.9.2-r14.exheres-0
similarity index 100%
rename from packages/sys-devel/gcc/gcc-4.9.2-r13.exheres-0
rename to packages/sys-devel/gcc/gcc-4.9.2-r14.exheres-0
diff --git a/packages/sys-devel/gcc/gcc-5.3.0-r5.exheres-0 b/packages/sys-devel/gcc/gcc-5.3.0-r6.exheres-0
similarity index 100%
rename from packages/sys-devel/gcc/gcc-5.3.0-r5.exheres-0
rename to packages/sys-devel/gcc/gcc-5.3.0-r6.exheres-0
diff --git a/packages/sys-devel/gcc/gcc-6.1.0-r1.exheres-0 b/packages/sys-devel/gcc/gcc-6.1.0-r2.exheres-0
similarity index 100%
rename from packages/sys-devel/gcc/gcc-6.1.0-r1.exheres-0
rename to packages/sys-devel/gcc/gcc-6.1.0-r2.exheres-0
diff --git a/packages/sys-devel/gcc/gcc.exlib b/packages/sys-devel/gcc/gcc.exlib
index 58c5459..4f2cde9 100644
--- a/packages/sys-devel/gcc/gcc.exlib
+++ b/packages/sys-devel/gcc/gcc.exlib
@@ -365,6 +365,22 @@ gcc_src_install() {
         edo popd
     done
 
+    edo pushd "${IMAGE}"
+    for tool in usr/"${CHOST}"/bin/"${CHOST}"-*-${SLOT}; do
+        [[ ${tool} =~ ^.*/${CHOST}-(.*)-${SLOT}$ ]] && local name=${BASH_REMATCH[1]}
+        dosym "${CHOST}-${name}-${SLOT}" /usr/"${CHOST}"/bin/${name}-${SLOT}
+        dobanned ${name}-${SLOT}
+        alternatives+=(
+            "${BANNEDDIR}"/${name}       ${name}-${SLOT}
+            /usr/"${CHOST}"/bin/${name}  ${name}-${SLOT}
+        )
+        if [[ -e usr/share/man/man1/${CHOST}-${name}-${SLOT}.1 ]]; then
+            dosym "${CHOST}-${name}-${SLOT}.1"    /usr/share/man/man1/${name}-${SLOT}.1
+            alternatives+=( /usr/share/man/man1/${name}.1  ${name}-${SLOT}.1 )
+        fi
+    done
+    edo popd
+
     alternatives_for gcc ${SLOT} ${SLOT} "${alternatives[@]}"
 
     edo find "${IMAGE}" -depth -type d -empty -delete
-- 
2.8.2

